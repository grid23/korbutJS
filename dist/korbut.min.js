/* Copyright Â©2014 Benjamin Moulin <hello@grid23.net>
   This work is free. You can redistribute it and/or modify it under the 
   terms of the Do What The Fuck You Want To Public License, Version 2, 
   as published by Sam Hocevar. See the COPYING file for more details. 
*/

!function a(b,c,d){function e(f,h){var i,j;if(!c[f]){if(!b[f]){if(i="function"==typeof require&&require,!h&&i)return i(f,!0);if(g)return g(f,!0);throw new Error("Cannot find module '"+f+"'")}j=c[f]={exports:{}},b[f][0].call(j.exports,function(a){var c=b[f][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[f].exports}var f,g="function"==typeof require&&require;for(f=0;f<d.length;f++)e(d[f]);return e}({1:[function(a,b){void function(){"use strict";var c=a("./utils"),d=a("./class").class;b=d(function(){return{constructor:function(a,b){a="string"==c.typeof(a)?a:function(){throw new Error("Event.type")}(),b=function(a){return!a.length||1==a.length&&-1!="undefined, null".indexOf(c.typeof(a[0]))?null:1==a.length&&a[0].constructor===Object&&a[0].hasOwnProperty("detail")?a[0].detail:1==a.length?a[0]:a}(c.spread(arguments,1)),Object.defineProperties(this,{_type:{configurable:!0,value:a},_detail:{configurable:!0,value:b},_timestamp:{configurable:!0,value:+new Date}})},initEvent:{value:function(){return this.constructor.apply(this,arguments)}},type:{enumerable:!0,get:function(){return this._type}},timestamp:{enumerable:!0,get:function(){return this._timestamp||0}},detail:{enumerable:!0,get:function(){return this._detail}}}})}()},{"./class":9,"./utils":12}],2:[function(a,b){void function(){"use strict";var c=a("./utils"),d=a("./class").class,e=a("./Event").Event;b.exports.EventTarget=d(function(a){return Object.defineProperties(a,{isEventListener:{value:function(a){return a&&("function"==typeof a||"function"==typeof a.handleEvent)}}}),{addEventListener:{enumerable:!0,value:function(b,d,e){return!this._events&&Object.defineProperty(this,"_events",{value:Object.create(null)}),1==arguments.length&&arguments[0]&&arguments[0].constructor===Object?function(a,b,c,d){c=0;for(d in b)b.hasOwnProperty(d)&&(c+=a.addEventListener(d,b[d]));return c}(this,arguments[0]):(b="string"==c.typeof(b)?b:null,d=a.isEventListener(d)?d:null,e=this._events[b],b&&d?(Array.isArray(e)?e.push(d):e&&e!==Object.prototype[b]?a.isEventListener(e)&&(this._events[b]=[e,d]):this._events[b]=d,1):0)}},removeEventListener:{enumerable:!0,value:function(b,d,e){return!this._events&&Object.defineProperty(this,"_events",{value:Object.create(null)}),1==arguments.length&&arguments[0]&&arguments[0].constructor===Object?function(a,b,c,d){c=0;for(d in b)b.hasOwnProperty(d)&&(c+=a.removeEventListener(d,b[d]));return c}(this,arguments[0]):(b="string"==c.typeof(b)?b:null,d=a.isEventListener(b)||"*"==b?b:null,e=this._events[b],b&&d&&e?e===d?(delete this._events[b],1):Array.isArray(e)?function(a,c,f,g){if("*"===d)return g=e.length,delete a._events[b],g;for(g=0;f=c.indexOf(d)>-1;)c.splice(f,1),g++;return a._events[b]=c,0==a._events[b].length&&delete a._events[b],g}(this,[].concat(e)):void 0:0)}},listeners:{enumerable:!0,value:function(a,b){a=c.spread(arguments),b="function"==typeof a[a.length-1]?a.pop():null,void function(b,d,e){for(;e>d;d++)a[d]=function(a){return"string"!=c.typeof(a)?void 0:Object.create(null,{add:{enumerable:!0,value:function(c){b.addEventListener(a,c)}},remove:{enumerable:!0,value:function(c){b.removeEventListener(a,c)}}})}(a[d])}(this,0,a.length),b&&b.apply(null,a)}},dispatchEvent:{enumerable:!0,value:function(a,b,c){if(a=e.isImplementedBy(a)?a:e.create.apply(null,arguments),b=(this._events||{})[a.type],c=0,"error"==a.type&&!b)throw e.isImplementedBy(a.detail)?a.detail:new Error;return b&&("function"==typeof b?(b.call(null,a),c++):Array.isArray(b)?void function(b){for(;b.length;)"function"==typeof b[i]?(b[i].call(null,a),c++):"function"==typeof b.handleEvent&&(b[i].call(b,a),c++)}([].concat(b)):"function"==typeof b.handleEvent&&(b.call(b,a),c++)),c}}}})}()},{"./Event":1,"./class":9,"./utils":12}],3:[function(a,b){void function(){"use strict";var c=a("./class").class;b.exports.Iterator=c(function(a){return Object.defineProperties(a,{iterable:{enumerable:!0,value:function(a){try{return Object.keys(a),!0}catch(b){return a.hasOwnProperty("length")}return!1}},iterate:{enumerable:!0,value:function(a,b,c,d,e,f){a=a||Object.create(null);try{return Object.keys(a)}catch(g){if(b=[],"[object String]"==Object.prototype.toString.call(a))for(c=0,d=a.length;d>c;c++)e=a.charCodeAt(c),f=a.charCodeAt(d-1>c?c+1:""),b.push(e>=55296&&56319>=e&&f>=56320&&57343>=f?a[c]+a[++c]:a[c]);return b}}}}),{constructor:function(b,c,d,e,f){for(c=!!arguments[1]||"[object String]"==Object.prototype.toString.call(arguments[0]),d=a.iterate(b),e=0,f=d.length,Object.defineProperties(this,{_pointer:{writable:!0,value:-1},_range:{value:[]}});f>e;e++)this._range[e]=c?[d[e]]:[d[e],arguments[0][d[e]]]},next:{enumerable:!0,value:function(a,b){return a="function"==typeof a?a:null,b=++this._pointer,Object.defineProperty(this,"_current",{configurable:!0,value:b>=(this._range||[]).length?{index:null,key:null,value:null,done:!0}:{index:b,key:this._range[b][0],value:this._range[b][this._range[b].length-1],done:!1}}),a&&a(this.current.done,this.current.key,this.current.value),this.current}},length:{enumerable:!0,value:function(){return this._range.length}},current:{enumerable:!0,get:function(){if(this._current)return this._current;throw new Error("iterator, not started")}}}})}()},{"./class":9}],4:[function(a,b){void function(){"use strict";var c=(a("./utils"),a("./class").class),d=a("./Iterator").Iterator;b.exports.Promise=c(function(a){return Object.defineProperties(a,{all:{enumerable:!0,value:function(){if(!d.iterable(promises))throw new TypeError("korbut.Promise.race requires an iterable object as argument 0.");return new b.exports.Promise(function(a,c,e,f,g){function h(b){return function(c){g[b]=c,--f||a(g)}}function i(a){c(a)}for(e=new d(promises),f=promises.length(),g=[];!e.next().done;)void function(a,c){c=a.value,b.exports.Promise.isImplementedBy(c)||(c=b.exports.Promise.cast(c)),c.then(h(a.index),i)}(e.current)})}},cast:{enumerable:!0,value:function(a){return new b.exports.Promise(function(b){b(a)})}},race:{enumerable:!0,value:function(a){if(!d.iterable(a))throw new TypeError("korbut.Promise.race requires an iterable object as argument 0.");return new b.exports.Promise(function(c,e,f,g){function h(a){g||(g=!0,c(a))}function i(){--f||e(new Error("all promises were rejected"))}for(iterator=new d(a),f=iterator.length();!iterator.next().done;)b.exports.Promise.isImplementedBy(iterator.current.value)&&iterator.current.value.then(h,i)})}},reject:{enumerable:!0,value:function(a){return new b.exports.Promise(function(b,c){c(a)})}},resolve:{enumerable:!0,value:function(a){return new b.exports.Promise(function(b){b(a)})}}}),{constructor:function(a,b){function c(a,e){for(c=d=function(){},b.key="resolved",b.value=a,Object.freeze(b),e=Array.isArray(this._onresolve)?[].concat(this._onresolve):[];e.length;)e.shift().call(null,a)}function d(a,e){for(c=d=function(){},b.key="rejected",b.value=a,Object.freeze(b),e=Array.isArray(this._onreject)?[].concat(this._onreject):[];e.length;)e.shift().call(null,a)}if("function"!=typeof a)throw new TypeError("Constructor korbut.Promise requires a resolver function as argument 0.");b={key:"pending",value:null},Object.defineProperty(this,"_state",{configurable:!0,get:function(){return b}}),a(c.bind(this),d.bind(this))},then:{enumerable:!0,value:function(a,c){return function(d,e,f){return e||f?e?new b.exports.Promise(function(b,c,e){try{e="function"==typeof a?a(d._state.value):null}catch(f){return void c(f)}e&&"function"==typeof e.then?e.then(function(a){b(a)},function(a){c(a)}):b(e)}):f?new b.exports.Promise(function(a,b,e){try{e="function"==typeof c?c(d._state.value):null}catch(f){return void b(f)}e&&"function"==typeof e.then?e.then(function(b){a(b)},function(a){b(a)}):a(e)}):void 0:new b.exports.Promise(function(b,e){!Array.isArray(d._onresolve)&&Object.defineProperty(d,"_onresolve",{value:[]}),!Array.isArray(d._onreject)&&Object.defineProperty(d,"_onreject",{value:[]}),d._onresolve.push(function(c,d){try{d=a(c)}catch(f){return void e(f)}d&&"function"==typeof d.then?d.then(function(a){b(a)},function(a){e(a)}):b(d)}),d._onreject.push(function(a,d){try{d=c(a)}catch(f){return void e(f)}d&&"function"==typeof d.then?d.then(function(a){b(a)},function(a){e(a)}):b(d)})})}(this,"resolved"==this._state.key,"rejected"==this._state.key)}},"catch":{enumerable:!0,value:function(a){return function(c){return new b.exports.Promise(function(b,d){c.then(b,function(b){return d(b),a(b)})})}(this)}},state:{enumerable:!0,get:function(){return(this._state||{}).key}}}})}()},{"./Iterator":3,"./class":9,"./utils":12}],5:[function(a,b){void function(){"use strict";var c=a("./utils"),d=a("./class").class;b.exports.Route=d(function(){return{constructor:function(a,b){a="string"==c.typeof(a)?a:function(){throw new Error("Route.path")}(),b=function(a){return!a.length||1==a.length&&-1!="undefined, null".indexOf(c.typeof(a[0]))?null:1==a.length&&a[0].constructor===Object&&a[0].hasOwnProperty("detail")?a[0].detail:1==a.length?a[0]:a}(c.spread(arguments,1)),Object.defineProperties(this,{_path:{configurable:!0,value:a},_detail:{configurable:!0,value:b},_timestamp:{configurable:!0,value:+new Date},_matches:{configurable:!0,value:{}}})},path:{enumerable:!0,get:function(){return this._path}},timestamp:{enumerable:!0,get:function(){return this._timestamp||0}},detail:{enumerable:!0,get:function(){return this._detail}},matches:{enumerable:!0,get:function(){return this._matches}}}})}()},{"./class":9,"./utils":12}],6:[function(a,b){void function(){"use strict";var c=a("./utils"),d=a("./class").class,e=a("./Iterator").Iterator,f=a("./Route").Route;b.exports.Router=d(function(a){return Object.defineProperties(a,{dispatcher:{enumerable:!0,value:function(a){function b(b,c,d,e){if(!a[b])if(-1==b.indexOf(":"))a[b]=new RegExp(b);else{for(d=[],c=[],e=b.split("/");e.length;)void function(a){":"===a[0]?(d.push(a.slice(1)),c.push("([^\\/]*)")):c.push(a)}(e.shift());a[b]=new RegExp(c.join("\\/")),a[b].assignments=d}return a[b]}return function(a,c,d,e){return d=b(a.path),e=c.match(d),e?1==e.length?!0:function(b,c){for(;c>b;b++)a._matches[d.assignments[b]]=e[b+1]}(0,d.assignments.length):!1}}(Object.create(null))},isRouteHandler:{value:function(a){return a&&("function"==typeof a||"function"==typeof a.handleRoute)}}}),{constructor:function(a){"function"==typeof a&&Object.defineProperty(this,"_dispatcher",{configurable:!0,value:a})},addRouteHandler:{enumerable:!0,value:function(b,d,e){return!this._routes&&Object.defineProperty(this,"_routes",{value:Object.create(null)}),1==arguments.length&&arguments[0]&&arguments[0].constructor===Object?function(a,b,c,d){c=0;for(d in b)b.hasOwnProperty(d)&&(c+=this.addRouteHandler(d,b[d]));return c}(this,arguments[0]):(b="string"==c.typeof(b)?b:null,d=a.isRouteHandler(d)?d:null,e=this._routes[b],b&&d?(Array.isArray(e)?e.push(d):e&&e!==Object.prototype[b]?a.isRouteHandler(e)&&(this._routes[b]=[e,d]):this._routes[b]=d,1):0)}},removeRouteHandler:{enumerable:!0,value:function(b,d){return!this._routes&&Object.defineProperty(this,"_routes",{value:Object.create(null)}),1==arguments.length&&arguments[0]&&arguments[0].constructor===Object?function(a,b,c,d){c=0;for(d in b)b.hasOwnProperty(d)&&(c+=this.removeRouteHandler(d,b[d]));return c}(this,arguments[0]):(b="string"==c.typeof(b)?b:null,d=a.isRouteHandler(b)||"*"==b?b:null,handlers=this.routes[b],b&&d&&handlers?handlers===d?(delete this._routes[b],1):Array.isArray(handlers)?function(a,c,e,f){if("*"===d)return f=handlers.length,delete a._routes[b],f;for(f=0;e=c.indexOf(d)>-1;)c.splice(e,1),f++;return a._routes[b]=c,0==a._routes[b].length&&delete a._routes[b],f}(this,[].concat(handlers)):void 0:0)}},dispatchRoute:{enumerable:!0,value:function(b,d){return b=f.isImplementedBy(b)?b:f.create.apply(null,arguments),d=function(a,b,c){for(c=Object.keys(a).sort();c.length;)b[c[0]]=a[c.shift()];return new e(b)}(this._routes||Object.create(null),Object.create(null)),function(e,f,g,h){function i(d){return a.isRouteHandler(d.value)?("*"!==d.key&&f++,h=d.value.call(null,b,j,f),"undefined"!==c.typeof(h)?h:f):Array.isArray(d.value)?function(a,e){function e(g){return a.length?(g=a.shift(),"*"!==d.key&&f++,h=g.call(null,b,a.length?e:j,f),"undefined"!==c.typeof(h)?h:f):j()}return e()}([].concat(d.value)):void 0}function j(){return d.next(),1==d.current.done?f:(g="*"===d.current.key?!0:e.dispatcher.call(this,b,d.current.key),g?i(d.current):j())}return f=0,j()}(this)}},handlers:{enumerable:!0,value:function(a,b){a=c.spread(arguments),b="function"==typeof a[a.length-1]?a.pop():null,void function(b,d,e){for(;e>d;d++)a[d]=function(a){return"string"!=c.typeof(a)?void 0:Object.create(null,{add:{enumerable:!0,value:function(c){return b.addRouteHandler(a,c)}},remove:{enumerable:!0,value:function(c){return b.removeRouteHandler(a,c)}}})}(a[d])}(this,0,a.length),b&&b.apply(a)}},dispatcher:{enumerable:!0,get:function(){return this._dispatcher||a.dispatcher}}}})}()},{"./Iterator":3,"./Route":5,"./class":9,"./utils":12}],7:[function(a,b){void function(){"use strict";var c=a("./utils"),d=a("./class").class,e=a("./Iterator").Iterator;b.exports.Serializer=d(function(a){var b="=",d="&",f=/%20/g,g=/\+/g;return Object.defineProperties(a,{serialize:{enumerable:!0,value:function(a,c,g,h,i){for(c=[],g=new e(a),h=this.delimiter||b,i=this.separator||d;!g.next().done;)c.push(escape(g.current.key)+h+encodeURIComponent(g.current.value));return c.join(i).replace(f,"+")}},objectify:{enumerable:!0,value:function(a,c,f,h,i){for(c={},h=this.delimiter||b,i=this.separator||d,f=new e(-1!=a.search(i)?a.split(i):a.length?[str]:[]);!f.next().done;)void function(a,b,d,e){b=a.indexOf(h),d=a.split(h,1),e=a.slice(b+1),c[d]=e}(unescape(f.current.value.replace(g,"%20")));return c}}}),{constructor:function(a){a=a&&a.constructor===Object?a:{},"string"==c.typeof(a.delimiter)&&Object.defineProperty(this,"_delimiter",{value:a.delimiter}),"string"==c.typeof(a.separator)&&Object.defineProperty(this,"_separator",{value:a.separator})},serializer:{enumerable:!0,value:function(b){return a.serialize.call(this,b)}},objectify:{enumerable:!0,value:function(b){return a.objectify.call(this,b)}}}})}()},{"./Iterator":3,"./class":9,"./utils":12}],8:[function(a,b){void function(){"use strict";var c=a("./utils"),d=a("./class").class;b.exports.UID=d(function(a){var b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",d="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",e=16,f=/[xy]/g;return Object.defineProperties(a,{uid:{enumerable:!0,value:function(a,g,h,i){return a="string"==c.typeof(this.map)?this.map:d,g="number"==c.typeof(this.radix)?this.radix:e,i="regexp"==c.typeof(this.regexp)?this.regexp:f,h=Date.now(),a.replace(i,function(a,c){return c=(h+Math.random()*g)%g|0,"y"===a&&(c=3&c|8),b[c]})}}}),{constructor:function(a){a=a&&a.constructor===Object?a:{},"string"==c.typeof(a.map)&&Object.defineProperty(this,"_map",{value:a.map}),"number"==c.typeof(a.radix)&&Object.defineProperty(this,"_map",{value:a.number})},generate:{enumerable:!0,value:function(){return a.uid.call(this)}},map:{enumerable:!0,get:function(){return this._map||d}},radix:{enumerable:!0,get:function(){return this._radix||e}}}})}()},{"./class":9,"./utils":12}],9:[function(a,b){void function(a){"use strict";b.exports.class=function(c,d,e,f){for(c=a.spread(arguments),d=Object.create(null),f=Object.create({}),c[c.length-1]=function g(b,c){if("function"==a.typeof(b))return g(b.call(null,d));b.constructor=b.hasOwnProperty("constructor")?b.constructor:function(){},e="function"!=a.typeof(b.constructor)||a.native(b.constructor)?"function"!=a.typeof(b.constructor.value)||a.native(b.constructor.value)?function(){}:b.constructor.value:b.constructor,delete b.constructor;try{return{prototype:Object.create(null,b)}}catch(f){for(c=Object.keys(b);c.length;)void function(a){b[a]=b[a].constructor==Object&&(b[a].hasOwnProperty("value")||b[a].hasOwnProperty("get")||b[a].hasOwnProperty("set"))?b[a]:{configurable:!0,enumerable:!0,writable:!0,value:b[a]}}(c.shift());return{prototype:Object.create(null,b)}}}(c[c.length-1]);c.length;)void function(a,b){try{b=Object.getOwnPropertyNames(a.prototype)}catch(c){b=[]}for(;b.length;)void function(a,b){Object.defineProperty(f,a,b)}(b[0],Object.getOwnPropertyDescriptor(a.prototype,b.shift()))}(c.shift());return Object.defineProperty(f,"constructor",{configurable:!0,value:e}),e.prototype=f,void function(a){for(;a.length;)Object.defineProperty(e,a[0],Object.getOwnPropertyDescriptor(d,a.shift()))}(Object.getOwnPropertyNames(d)),!e.hasOwnProperty("create")&&Object.defineProperty(e,"create",{enumerable:!0,value:function(b){function c(){return e.apply(this,b)}return b=a.spread(arguments),c.prototype=e.prototype,new c}}),!e.hasOwnProperty("extend")&&Object.defineProperty(e,"extend",{enumerable:!0,value:function(){return b.exports.class.apply(null,[e].concat(a.spread(arguments)))}}),!e.hasOwnProperty("isImplementedBy")&&Object.defineProperty(e,"isImplementedBy",{enumerable:!0,value:function(b,c,d){if(c="function"==a.typeof(b)?b.prototype:Object.create(null),!b)return!1;if(b instanceof e)return!0;for(d in e.prototype)if("constructor"!=d&&function(a,b){return a&&b&&a==b?!1:!0}(Object.getOwnPropertyDescriptor(c,d),Object.getOwnPropertyDescriptor(e.prototype,d)))return!1;return!0}}),!e.hasOwnProperty("extend")&&Object.defineProperty(e,"implementsOn",{enumerable:!0,value:function(b,c,d){for(c="function"==!a.typeof(b)?b.prototype:{},d=Object.getOwnPropertyNames(e.prototype);d.length;)Object.defineProperty(c,d[0],Object.getOwnPropertyDescriptor(e.prototype,d.shift()));e.apply(this,a.spread(arguments,1))}}),e},b.exports.singleton=function(a,c){a=b.exports.class.apply(null,arguments),c=b.exports.class.call(null,a,function(b,d){for(d in a)b[d]=a[d];return{constructor:function(){return c.instance?c.instance:(c.instance=this,a.apply(this,arguments))}}})}}(a("./utils"))},{"./utils":12}],10:[function(a,b){void function(){"use strict";var c=a("./Promise").Promise;b.exports=new c(function(a,b,c){function d(){c||(c=!0,setTimeout(a,4,{timestamp:Date.now(),nodes:{documentElement:document.documentElement,head:document.head,body:document.body,title:function(a){return a?a:document.head.appendChild(document.createElement("title"))}(document.head.getElementsByTagName("title")[0]),viewport:function(a){return a?a:(a=document.createElement("meta"),a.setAttribute("name","viewport"),a.setAttribute("content",""),document.head.appendChild(a))}(document.head.querySelector("meta[name=viewport]"))}}))}function e(){return-1!="interactive,complete".indexOf(document.readyState)}e()?d():(window.addEventListener("DOMContentLoaded",d,!0),window.addEventListener("load",d,!0),document.addEventListener("readystatechange",e,!0))})}()},{"./Promise":4}],11:[function(a){void function(){"use strict";var b=a("./domReady");window.korbut=function(a){"function"==typeof a&&b.then(a)},Object.defineProperties(window.korbut,{utils:{enumerable:!0,value:a("./utils").utils},"class":{enumerable:!0,value:a("./class").class},singleton:{enumerable:!0,value:a("./class").singleton},Iterator:{enumerable:!0,value:a("./Iterator").Iterator},EventTarget:{enumerable:!0,value:a("./EventTarget").EventTarget},Event:{enumerable:!0,value:a("./Event").Event},Promise:{enumerable:!0,value:a("./Promise").Promise},Router:{enumerable:!0,value:a("./Router").Router},Route:{enumerable:!0,value:a("./Route").Route},UID:{enumerable:!0,value:a("./UID").UID},Serializer:{enumerable:!0,value:a("./Serializer").Serializer}})}({version:"korbutJS-ES5-0.0.1-1396275302231"})},{"./Event":1,"./EventTarget":2,"./Iterator":3,"./Promise":4,"./Route":5,"./Router":6,"./Serializer":7,"./UID":8,"./class":9,"./domReady":10,"./utils":12}],12:[function(a,b){void function(){"use strict";b.exports.native=function(a){return function(b){try{return"function"==typeof b?!!b.toString().match(a):!1}catch(c){return null}}}(/\s*\[native code\]\s*/i),b.exports.spread=function(a){return function(b,c){return a.call(b,c)}}(Array.prototype.slice),b.exports.typeof=function(a){return function(b,c){return c=typeof b,"object"==c?a.call(b).slice(8,-1).toLowerCase():c}}(Object.prototype.toString)}()},{}]},{},[11]);